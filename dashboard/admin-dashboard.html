<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - HackToLive CTF</title>
    <link rel="icon" href="../images/logo.png" type="image/png">
    <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Courier New', monospace;background:linear-gradient(135deg,#0d1f3c 0%,#1a2e5c 30%,#2a5298 60%,#1a3a52 100%);min-height:100vh;color:#333;position:relative;overflow-x:hidden}body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at 20% 50%, rgba(0,255,0,0.03) 0%, transparent 50%);pointer-events:none;z-index:-1}header{background:linear-gradient(180deg, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.8) 100%);color:white;padding:40px 30px;text-align:center;border-bottom:3px solid #00ff00;box-shadow:0 10px 50px rgba(0,255,0,0.4), inset 0 1px 0 rgba(0,255,0,0.2);position:relative;overflow:hidden}header::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg, transparent, #00ff00, transparent);opacity:0.7}header h1{font-size:3em;text-shadow:0 0 20px #00ff00, 0 0 40px #00ff00, 0 0 60px #00aa00, 3px 3px 20px rgba(0,0,0,0.8);letter-spacing:3px;margin-bottom:8px;animation:glow 3s ease-in-out infinite}@keyframes glow{0%{text-shadow:0 0 20px #00ff00, 0 0 40px #00ff00}50%{text-shadow:0 0 30px #00ff00, 0 0 50px #00ff00, 0 0 70px #00aa00}100%{text-shadow:0 0 20px #00ff00, 0 0 40px #00ff00}}header p{color:#00ff00;font-size:1.1em;letter-spacing:1px;text-shadow:0 0 10px rgba(0,255,0,0.5)}.container{max-width:1200px;margin:0 auto;padding:40px 20px}.back-btn{display:inline-block;margin-bottom:30px;padding:15px 30px;background:linear-gradient(135deg, #00ff00 0%, #00cc00 100%);color:#000;text-decoration:none;border-radius:8px;font-weight:bold;font-size:1.05em;transition:all 0.3s cubic-bezier(0.68,-0.55,0.265,1.55);box-shadow:0 8px 25px rgba(0,255,0,0.3), inset 0 -2px 0 rgba(0,0,0,0.2);cursor:pointer}button{transition:all 0.3s}.back-btn:hover{transform:translateY(-5px);box-shadow:0 15px 40px rgba(0,255,0,0.5), inset 0 -2px 0 rgba(0,0,0,0.2)}.info-box{background:linear-gradient(135deg,#fff,#f0f0f0);padding:20px;border-radius:8px;box-shadow:0 4px 15px rgba(0,0,0,0.1);margin-bottom:20px}.user-list{list-style:none;padding-left:0}.user-item{margin-bottom:8px;display:flex;align-items:center}.user-item button{margin-left:10px}.input-row{margin-bottom:15px}.input-row input{padding:8px;margin-right:10px;border:1px solid #00ff00;border-radius:4px}.btn-small{background:linear-gradient(135deg, #00ff00 0%, #00cc00 100%);color:#000;padding:8px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:bold;font-size:0.9em;transition:all 0.3s;box-shadow:0 4px 15px rgba(0,255,0,0.3);margin-right:10px}.btn-small:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,255,0,0.5)}</style>
</head>
<body>
<header><h1>Admin Dashboard</h1><p>Manage users and progress</p></header>
<div class="container">
    <a href="index.html" class="back-btn">‚Üê BACK TO HUB</a>
    <a href="#" class="back-btn" style="background:#ff5555;" onclick="sessionStorage.removeItem('isAdmin');window.location.href='auth/admin-login.html'">Logout</a>
    <div class="input-row">
        <button class="btn-small" onclick="resetAll()">Reset All Progress</button>
        <input type="text" id="resetUserInput" placeholder="Username to reset" />
        <button class="btn-small" onclick="resetUser()">Reset User</button>
    </div>
    <div class="input-row">
        <input type="number" id="clearChallengeId" placeholder="Challenge ID to clear" />
        <button class="btn-small" onclick="clearChallenge()">Clear Challenge</button>
    </div>
    <div class="input-row">
        <a href="auth/view-users.html" class="btn-small">View Registered Users</a>
    </div>
    <div id="usersList" class="info-box"></div>
</div>
<script>
// require admin login
if(sessionStorage.getItem('isAdmin')!=='true'){
    window.location.href='auth/admin-login.html';
}

function loadUsers(){
    const users = JSON.parse(localStorage.getItem('ctfUsers')||'{}');
    const div = document.getElementById('usersList');
    if(Object.keys(users).length===0){
        div.innerHTML='<p>No users registered yet.</p>';
        return;
    }
    let html = '<h3>Registered Users</h3><ul class="user-list">';
    Object.entries(users).forEach(([name,data])=>{
        html += `<li class="user-item"><strong>${name}</strong> - ${data.points} pts (${data.solved.length} solved) <button onclick="deleteUser('${name}')" class="btn-small">Delete</button></li>`;
    });
    html += '</ul>';
    div.innerHTML = html;
}

function resetAll(){
    if(confirm('Are you sure you want to reset all user progress?')){
        localStorage.removeItem('ctfUsers');
        loadUsers();
    }
}

function resetUser(){
    const u = document.getElementById('resetUserInput').value.trim();
    if(!u) return alert('Enter a username');
    const users = JSON.parse(localStorage.getItem('ctfUsers')||'{}');
    if(users[u]){
        delete users[u];
        localStorage.setItem('ctfUsers', JSON.stringify(users));
        loadUsers();
    } else {
        alert('User not found');
    }
}

function deleteUser(name){
    const users = JSON.parse(localStorage.getItem('ctfUsers')||'{}');
    delete users[name];
    localStorage.setItem('ctfUsers', JSON.stringify(users));
    loadUsers();
}

function clearChallenge(){
    const cid = parseInt(document.getElementById('clearChallengeId').value);
    if(isNaN(cid)) return alert('Enter valid challenge ID');
    const users = JSON.parse(localStorage.getItem('ctfUsers')||'{}');
    Object.values(users).forEach(u=>{
        const idx = u.solved.indexOf(cid);
        if(idx!==-1){
            u.solved.splice(idx,1);
            // remove points (we don't know pts value, so cannot adjust precisely)
            // For simplicity we'll not adjust points here
        }
    });
    localStorage.setItem('ctfUsers', JSON.stringify(users));
    loadUsers();
}

// initial load
loadUsers();
</script>
<script src="../js/profile-widget.js"></script>
</body>
</html>