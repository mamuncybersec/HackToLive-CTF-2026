<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Verification - HackToLive CTF</title>
    <link rel="icon" href="../images/logo.png" type="image/png">
    <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Courier New',monospace;background:linear-gradient(135deg,#0d1f3c 0%,#1a2e5c 30%,#2a5298 60%,#1a3a52 100%);min-height:100vh;color:#fff;display:flex;align-items:center;justify-content:center}form{background:rgba(0,0,0,0.8);padding:20px;border-radius:10px;box-shadow:0 0 20px rgba(0,255,0,0.4);width:450px}h2{margin-bottom:15px;text-align:center;color:#00ff00}p{margin:10px 0;font-size:0.9em}input[type=text]{width:100%;padding:8px;margin:5px 0;border:1px solid #00ff00;border-radius:4px;background:#222;color:#fff}label{display:block;margin-top:8px}button{width:100%;padding:10px;background:#00ff00;color:#000;border:none;border-radius:4px;font-weight:bold;cursor:pointer;transition:0.3s;margin-top:10px}button:hover{background:#00cc00}small{color:#f88}a{color:#00ff00;text-decoration:none;font-size:0.9em;display:block;text-align:center;margin-top:10px}.success{color:#00ff00}code{background:#111;padding:2px 6px;border-radius:3px;color:#00ff00}button.secondary{background:#1a2e5c;color:#00ff00;border:1px solid #00ff00}button.secondary:hover{background:#2a3d6c}#successMsg{display:none;text-align:center}#verifyForm{display:block}</style>
</head>
<body>
<div id="verifyForm">
    <form id="emailForm">
        <h2>Email Verification</h2>
        <p>✓ Account registered successfully!</p>
        <p>A verification code has been sent to:</p>
        <p style="color:#00ff00;font-weight:bold"><span id="emailDisplay"></span></p>
        
        <label>Enter Verification Code
            <input type="text" id="verificationInput" placeholder="Enter 6-character code" required maxlength="6">
        </label>
        <div id="error" style="height:18px;margin-top:8px"><small></small></div>
        
        <button type="submit">Verify Email</button>
        <p style="font-size:0.8em;color:#aaa;margin-top:15px">If you didn't receive the code, check your spam folder or resend it.</p>
        <button type="button" onclick="resendCode()" class="secondary">Resend Code</button>
        <a href="login.html">Back to Login</a>
    </form>
</div>

<div id="successMsg">
    <form>
        <h2 class="success">✓ Email Verified!</h2>
        <p>Your account has been verified successfully.</p>
        <p style="margin-top:20px;color:#aaa">You can now log in with your credentials.</p>
        <a href="login.html" style="display:inline-block;width:100%;padding:10px;background:#00ff00;color:#000;border:none;border-radius:4px;font-weight:bold;text-align:center;margin-top:15px">Go to Login</a>
    </form>
</div>

<script>
function getRegistered(){
    return JSON.parse(localStorage.getItem('registeredUsers')||'{}');
}

function saveRegistered(users){
    localStorage.setItem('registeredUsers',JSON.stringify(users));
}

const username=sessionStorage.getItem('registeredUsername');
const email=sessionStorage.getItem('registeredEmail');
const correctCode=sessionStorage.getItem('verificationCode');

if(!username || !email || !correctCode){
    alert('Invalid verification session. Please register again.');
    window.location.href='register.html';
}

document.getElementById('emailDisplay').textContent=email;

document.getElementById('emailForm').addEventListener('submit',e=>{
    e.preventDefault();
    const userCode=document.getElementById('verificationInput').value.trim().toUpperCase();
    const error=document.getElementById('error').querySelector('small');
    
    if(!userCode){
        error.textContent='Please enter the verification code';
        return;
    }
    
    if(userCode!==correctCode){
        error.textContent='Invalid verification code';
        return;
    }
    
    const users=getRegistered();
    users[username].verified=true;
    saveRegistered(users);
    
    sessionStorage.removeItem('registeredUsername');
    sessionStorage.removeItem('registeredEmail');
    sessionStorage.removeItem('verificationCode');
    
    document.getElementById('verifyForm').style.display='none';
    document.getElementById('successMsg').style.display='block';
});

function resendCode(){
    const newCode=Math.random().toString(36).substr(2,6).toUpperCase();
    sessionStorage.setItem('verificationCode',newCode);
    alert('New verification code has been generated:\n'+newCode+'\n\nCheck your email or use this code above.');
}
</script>
<script src="../js/profile-widget.js"></script>
</body>
</html>
